"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validate = exports.getValidator = exports.validateState = exports.countNumbers = exports.countUpperCase = exports.count = exports.ValidationType = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _validationFunc;

/* Predefined validation options. However, a custom rule, which takes a function, can be created
   and thus any validation rule that is desired, can be created. */
var ValidationType;
/* Function that is tied to a custom rule. Must return a boolean and will always receive two arguments: 
   value: current value of the input field where this custom rule is tied 
   state: the most updated state of the entire form. */

exports.ValidationType = ValidationType;

(function (ValidationType) {
  ValidationType["Require"] = "isRequired";
  ValidationType["MinLength"] = "minLength";
  ValidationType["MaxLength"] = "maxLength";
  ValidationType["MinValue"] = "minValue";
  ValidationType["MaxValue"] = "maxValue";
  ValidationType["MinUppercaseCharacters"] = "minUppercaseCharacters";
  ValidationType["MaxUppercaseCharacters"] = "maxUppercaseCharacters";
  ValidationType["MinNumericalSymbols"] = "minNumericalSymbols";
  ValidationType["MaxNumericalSymbols"] = "maxNumericalSymbols";
  ValidationType["CustomRule"] = "customRule";
})(ValidationType || (exports.ValidationType = ValidationType = {}));

var count = function count(target, callback) {
  var result = 0;

  for (var i = 0; i < target.length; i++) {
    if (callback(target[i])) {
      result++;
    }
  }

  return result;
};

exports.count = count;

var countUpperCase = function countUpperCase(target) {
  return count(target, function (e) {
    return e >= 'A' && e <= 'Z';
  });
};

exports.countUpperCase = countUpperCase;

var countNumbers = function countNumbers(target) {
  return count(target, function (e) {
    var n = parseInt(e);
    return typeof n === 'number' && !Number.isNaN(n);
  });
};

exports.countNumbers = countNumbers;
var validationFunc = (_validationFunc = {}, (0, _defineProperty2["default"])(_validationFunc, ValidationType.Require, function (value, isValid) {
  return isValid && value.toString().trim().length > 0;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MinLength, function (value, isValid, validator) {
  if (Array.isArray(value)) {
    return isValid && value.length >= validator.value;
  }

  return isValid && value.toString().trim().length >= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MaxLength, function (value, isValid, validator) {
  if (Array.isArray(value)) {
    return isValid && value.length <= validator.value;
  }

  return isValid && value.toString().trim().length <= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MinValue, function (value, isValid, validator) {
  return isValid && +value >= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MaxValue, function (value, isValid, validator) {
  return isValid && +value <= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MinUppercaseCharacters, function (value, isValid, validator) {
  var uppercaseChars = countUpperCase(value.toString());
  return isValid && uppercaseChars >= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MaxUppercaseCharacters, function (value, isValid, validator) {
  var uppercaseChars = countUpperCase(value.toString());
  return isValid && uppercaseChars <= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MinNumericalSymbols, function (value, isValid, validator) {
  var numericalSymbols = countNumbers(value.toString());
  return isValid && numericalSymbols >= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MaxNumericalSymbols, function (value, isValid, validator) {
  var numericalSymbols = countNumbers(value.toString());
  return isValid && numericalSymbols <= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.CustomRule, function (value, isValid, validator, state) {
  return isValid && typeof validator.value === 'function' && validator.value(value, state);
}), _validationFunc);

var validateState = function validateState(state) {
  var isValid = true;

  for (var _key in state.inputs) {
    isValid = isValid && state.inputs[_key].isValid;
  }

  return isValid;
};

exports.validateState = validateState;

var getValidator = function getValidator(type, value) {
  return {
    type: type,
    value: value
  };
};

exports.getValidator = getValidator;

var validate = function validate(value, validators, state) {
  var isValid = true;
  validators.forEach(function (validator) {
    var func = validationFunc[validator.type];

    if (typeof func !== 'undefined') {
      isValid = func(value, isValid, validator, state);
    }
  });
  return isValid;
};

exports.validate = validate;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9mb3JtLnZhbGlkYXRpb24udHMiXSwibmFtZXMiOlsiVmFsaWRhdGlvblR5cGUiLCJjb3VudCIsInRhcmdldCIsImNhbGxiYWNrIiwicmVzdWx0IiwiaSIsImxlbmd0aCIsImNvdW50VXBwZXJDYXNlIiwiZSIsImNvdW50TnVtYmVycyIsIm4iLCJwYXJzZUludCIsIk51bWJlciIsImlzTmFOIiwidmFsaWRhdGlvbkZ1bmMiLCJSZXF1aXJlIiwidmFsdWUiLCJpc1ZhbGlkIiwidG9TdHJpbmciLCJ0cmltIiwiTWluTGVuZ3RoIiwidmFsaWRhdG9yIiwiQXJyYXkiLCJpc0FycmF5IiwiTWF4TGVuZ3RoIiwiTWluVmFsdWUiLCJNYXhWYWx1ZSIsIk1pblVwcGVyY2FzZUNoYXJhY3RlcnMiLCJ1cHBlcmNhc2VDaGFycyIsIk1heFVwcGVyY2FzZUNoYXJhY3RlcnMiLCJNaW5OdW1lcmljYWxTeW1ib2xzIiwibnVtZXJpY2FsU3ltYm9scyIsIk1heE51bWVyaWNhbFN5bWJvbHMiLCJDdXN0b21SdWxlIiwic3RhdGUiLCJ2YWxpZGF0ZVN0YXRlIiwia2V5IiwiaW5wdXRzIiwiZ2V0VmFsaWRhdG9yIiwidHlwZSIsInZhbGlkYXRlIiwidmFsaWRhdG9ycyIsImZvckVhY2giLCJmdW5jIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBRUE7QUFDQTtJQUNZQSxjO0FBYVo7QUFDQTtBQUNBOzs7O1dBZllBLGM7QUFBQUEsRUFBQUEsYztBQUFBQSxFQUFBQSxjO0FBQUFBLEVBQUFBLGM7QUFBQUEsRUFBQUEsYztBQUFBQSxFQUFBQSxjO0FBQUFBLEVBQUFBLGM7QUFBQUEsRUFBQUEsYztBQUFBQSxFQUFBQSxjO0FBQUFBLEVBQUFBLGM7QUFBQUEsRUFBQUEsYztHQUFBQSxjLDhCQUFBQSxjOztBQW1DTCxJQUFNQyxLQUFLLEdBQUcsU0FBUkEsS0FBUSxDQUFDQyxNQUFELEVBQWlCQyxRQUFqQixFQUFrRTtBQUNuRixNQUFJQyxNQUFNLEdBQUcsQ0FBYjs7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Q08sSUFBTUMsYUFBYSxHQUFHLFNBQWhCQSxhQUFnQixDQUFDRCxLQUFELEVBQW9DO0FBQzdELE1BQUlqQixPQUFnQixHQUFHLElBQXZCOztBQUNBLE9BQUssSUFBTW1CLElBQVgsSUFBa0JGLEtBQUssQ0FBQ0csTUFBeEIsRUFBZ0M7QUFDNUJwQixJQUFBQSxPQUFPLEdBQUdBLE9BQU8sSUFBSWlCLEtBQUssQ0FBQ0csTUFBTixDQUFhRCxJQUFiLEVBQWtCbkIsT0FBdkM7QUFDSDs7QUFDRCxTQUFPQSxPQUFQO0FBQ0gsQ0FOTTs7OztBQVFBLElBQU1xQixZQUFZLEdBQUcsU0FBZkEsWUFBZSxDQUFDQyxJQUFELEVBQXVCdkIsS0FBdkI7QUFBQSxTQUE4RDtBQUFFdUIsSUFBQUEsSUFBSSxFQUFKQSxJQUFGO0FBQVF2QixJQUFBQSxLQUFLLEVBQUxBO0FBQVIsR0FBOUQ7QUFBQSxDQUFyQjs7OztBQUVBLElBQU13QixRQUFRLEdBQUcsU0FBWEEsUUFBVyxDQUFDeEIsS0FBRCxFQUF1QnlCLFVBQXZCLEVBQWdEUCxLQUFoRCxFQUFtRjtBQUN2RyxNQUFJakIsT0FBZ0IsR0FBRyxJQUF2QjtBQUNBd0IsRUFBQUEsVUFBVSxDQUFDQyxPQUFYLENBQW1CLFVBQUNyQixTQUFELEVBQWU7QUFDOUIsUUFBTXNCLElBQWdDLEdBQUc3QixjQUFjLENBQUNPLFNBQVMsQ0FBQ2tCLElBQVgsQ0FBdkQ7O0FBQ0EsUUFBSSxPQUFPSSxJQUFQLEtBQWdCLFdBQXBCLEVBQWlDO0FBQzdCMUIsTUFBQUEsT0FBTyxHQUFHMEIsSUFBSSxDQUFDM0IsS0FBRCxFQUFRQyxPQUFSLEVBQWlCSSxTQUFqQixFQUE0QmEsS0FBNUIsQ0FBZDtBQUNIO0FBQ0osR0FMRDtBQU1BLFNBQU9qQixPQUFQO0FBQ0gsQ0FUTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1TdGF0ZSwgRm9ybVZhbHVlVHlwZSwgRm9ybUVudHJ5Q29uc3RyYWludCB9IGZyb20gJy4vZm9ybS5ob29rJztcblxuLyogUHJlZGVmaW5lZCB2YWxpZGF0aW9uIG9wdGlvbnMuIEhvd2V2ZXIsIGEgY3VzdG9tIHJ1bGUsIHdoaWNoIHRha2VzIGEgZnVuY3Rpb24sIGNhbiBiZSBjcmVhdGVkXG4gICBhbmQgdGh1cyBhbnkgdmFsaWRhdGlvbiBydWxlIHRoYXQgaXMgZGVzaXJlZCwgY2FuIGJlIGNyZWF0ZWQuICovXG5leHBvcnQgZW51bSBWYWxpZGF0aW9uVHlwZSB7XG4gICAgUmVxdWlyZSA9ICdpc1JlcXVpcmVkJyxcbiAgICBNaW5MZW5ndGggPSAnbWluTGVuZ3RoJyxcbiAgICBNYXhMZW5ndGggPSAnbWF4TGVuZ3RoJyxcbiAgICBNaW5WYWx1ZSA9ICdtaW5WYWx1ZScsXG4gICAgTWF4VmFsdWUgPSAnbWF4VmFsdWUnLFxuICAgIE1pblVwcGVyY2FzZUNoYXJhY3RlcnMgPSAnbWluVXBwZXJjYXNlQ2hhcmFjdGVycycsXG4gICAgTWF4VXBwZXJjYXNlQ2hhcmFjdGVycyA9ICdtYXhVcHBlcmNhc2VDaGFyYWN0ZXJzJyxcbiAgICBNaW5OdW1lcmljYWxTeW1ib2xzID0gJ21pbk51bWVyaWNhbFN5bWJvbHMnLFxuICAgIE1heE51bWVyaWNhbFN5bWJvbHMgPSAnbWF4TnVtZXJpY2FsU3ltYm9scycsXG4gICAgQ3VzdG9tUnVsZSA9ICdjdXN0b21SdWxlJ1xufVxuXG4vKiBGdW5jdGlvbiB0aGF0IGlzIHRpZWQgdG8gYSBjdXN0b20gcnVsZS4gTXVzdCByZXR1cm4gYSBib29sZWFuIGFuZCB3aWxsIGFsd2F5cyByZWNlaXZlIHR3byBhcmd1bWVudHM6IFxuICAgdmFsdWU6IGN1cnJlbnQgdmFsdWUgb2YgdGhlIGlucHV0IGZpZWxkIHdoZXJlIHRoaXMgY3VzdG9tIHJ1bGUgaXMgdGllZCBcbiAgIHN0YXRlOiB0aGUgbW9zdCB1cGRhdGVkIHN0YXRlIG9mIHRoZSBlbnRpcmUgZm9ybS4gKi9cbmV4cG9ydCB0eXBlIEN1c3RvbVZhbGlkYXRpb25SdWxlPFQgZXh0ZW5kcyBGb3JtVmFsdWVUeXBlLCBTIGV4dGVuZHMgRm9ybUVudHJ5Q29uc3RyYWludCA9IGFueT4gPSAoXG4gICAgdmFsdWU6IFQsXG4gICAgc3RhdGU6IEZvcm1TdGF0ZTxTPlxuKSA9PiBib29sZWFuO1xuXG5leHBvcnQgdHlwZSBWYWxpZGF0aW9uVmFsdWUgPSBGb3JtVmFsdWVUeXBlIHwgQ3VzdG9tVmFsaWRhdGlvblJ1bGU8YW55LCBhbnk+O1xuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRvciB7XG4gICAgdHlwZTogVmFsaWRhdGlvblR5cGU7XG4gICAgdmFsdWU6IFZhbGlkYXRpb25WYWx1ZTtcbn1cblxuZXhwb3J0IHR5cGUgVmFsaWRhdGlvbkZ1bmMgPSAoXG4gICAgdmFsdWU6IEZvcm1WYWx1ZVR5cGUsXG4gICAgaXNWYWxpZDogYm9vbGVhbixcbiAgICB2YWxpZGF0b3I6IFZhbGlkYXRvcixcbiAgICBzdGF0ZTogRm9ybVN0YXRlPGFueT5cbikgPT4gYm9vbGVhbjtcblxuZXhwb3J0IGNvbnN0IGNvdW50ID0gKHRhcmdldDogc3RyaW5nLCBjYWxsYmFjazogKGVudHJ5OiBzdHJpbmcpID0+IGJvb2xlYW4pOiBudW1iZXIgPT4ge1xuICAgIGxldCByZXN1bHQgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChjYWxsYmFjayh0YXJnZXRbaV0pKSB7XG4gICAgICAgICAgICByZXN1bHQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufTtcblxuZXhwb3J0IGNvbnN0IGNvdW50VXBwZXJDYXNlID0gKHRhcmdldDogc3RyaW5nKTogbnVtYmVyID0+IHtcbiAgICByZXR1cm4gY291bnQodGFyZ2V0LCAoZSkgPT4gZSA+PSAnQScgJiYgZSA8PSAnWicpO1xufTtcblxuZXhwb3J0IGNvbnN0IGNvdW50TnVtYmVycyA9ICh0YXJnZXQ6IHN0cmluZyk6IG51bWJlciA9PiB7XG4gICAgcmV0dXJuIGNvdW50KHRhcmdldCwgKGUpID0+IHtcbiAgICAgICAgY29uc3QgbiA9IHBhcnNlSW50KGUpO1xuICAgICAgICByZXR1cm4gdHlwZW9mIG4gPT09ICdudW1iZXInICYmICFOdW1iZXIuaXNOYU4obik7XG4gICAgfSk7XG59O1xuXG5jb25zdCB2YWxpZGF0aW9uRnVuYzogeyBba2V5OiBzdHJpbmddOiBWYWxpZGF0aW9uRnVuYyB9ID0ge1xuICAgIFtWYWxpZGF0aW9uVHlwZS5SZXF1aXJlXTogKHZhbHVlLCBpc1ZhbGlkKSA9PiB7XG4gICAgICAgIHJldHVybiBpc1ZhbGlkICYmIHZhbHVlLnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCA+IDA7XG4gICAgfSxcbiAgICBbVmFsaWRhdGlvblR5cGUuTWluTGVuZ3RoXTogKHZhbHVlLCBpc1ZhbGlkLCB2YWxpZGF0b3IpID0+IHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNWYWxpZCAmJiB2YWx1ZS5sZW5ndGggPj0gdmFsaWRhdG9yLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc1ZhbGlkICYmIHZhbHVlLnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCA+PSB2YWxpZGF0b3IudmFsdWU7XG4gICAgfSxcbiAgICBbVmFsaWRhdGlvblR5cGUuTWF4TGVuZ3RoXTogKHZhbHVlLCBpc1ZhbGlkLCB2YWxpZGF0b3IpID0+IHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNWYWxpZCAmJiB2YWx1ZS5sZW5ndGggPD0gdmFsaWRhdG9yLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc1ZhbGlkICYmIHZhbHVlLnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCA8PSB2YWxpZGF0b3IudmFsdWU7XG4gICAgfSxcbiAgICBbVmFsaWRhdGlvblR5cGUuTWluVmFsdWVdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvcikgPT4ge1xuICAgICAgICByZXR1cm4gaXNWYWxpZCAmJiArdmFsdWUgPj0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLk1heFZhbHVlXTogKHZhbHVlLCBpc1ZhbGlkLCB2YWxpZGF0b3IpID0+IHtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgJiYgK3ZhbHVlIDw9IHZhbGlkYXRvci52YWx1ZTtcbiAgICB9LFxuICAgIFtWYWxpZGF0aW9uVHlwZS5NaW5VcHBlcmNhc2VDaGFyYWN0ZXJzXTogKHZhbHVlLCBpc1ZhbGlkLCB2YWxpZGF0b3IpID0+IHtcbiAgICAgICAgY29uc3QgdXBwZXJjYXNlQ2hhcnM6IG51bWJlciA9IGNvdW50VXBwZXJDYXNlKHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgICAgICByZXR1cm4gaXNWYWxpZCAmJiB1cHBlcmNhc2VDaGFycyA+PSB2YWxpZGF0b3IudmFsdWU7XG4gICAgfSxcbiAgICBbVmFsaWRhdGlvblR5cGUuTWF4VXBwZXJjYXNlQ2hhcmFjdGVyc106ICh2YWx1ZSwgaXNWYWxpZCwgdmFsaWRhdG9yKSA9PiB7XG4gICAgICAgIGNvbnN0IHVwcGVyY2FzZUNoYXJzOiBudW1iZXIgPSBjb3VudFVwcGVyQ2FzZSh2YWx1ZS50b1N0cmluZygpKTtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgJiYgdXBwZXJjYXNlQ2hhcnMgPD0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLk1pbk51bWVyaWNhbFN5bWJvbHNdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvcikgPT4ge1xuICAgICAgICBjb25zdCBudW1lcmljYWxTeW1ib2xzOiBudW1iZXIgPSBjb3VudE51bWJlcnModmFsdWUudG9TdHJpbmcoKSk7XG4gICAgICAgIHJldHVybiBpc1ZhbGlkICYmIG51bWVyaWNhbFN5bWJvbHMgPj0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLk1heE51bWVyaWNhbFN5bWJvbHNdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvcikgPT4ge1xuICAgICAgICBjb25zdCBudW1lcmljYWxTeW1ib2xzOiBudW1iZXIgPSBjb3VudE51bWJlcnModmFsdWUudG9TdHJpbmcoKSk7XG4gICAgICAgIHJldHVybiBpc1ZhbGlkICYmIG51bWVyaWNhbFN5bWJvbHMgPD0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLkN1c3RvbVJ1bGVdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvciwgc3RhdGUpID0+IHtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgJiYgdHlwZW9mIHZhbGlkYXRvci52YWx1ZSA9PT0gJ2Z1bmN0aW9uJyAmJiB2YWxpZGF0b3IudmFsdWUodmFsdWUsIHN0YXRlKTtcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVTdGF0ZSA9IChzdGF0ZTogRm9ybVN0YXRlPGFueT4pOiBib29sZWFuID0+IHtcbiAgICBsZXQgaXNWYWxpZDogYm9vbGVhbiA9IHRydWU7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gc3RhdGUuaW5wdXRzKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHN0YXRlLmlucHV0c1trZXldLmlzVmFsaWQ7XG4gICAgfVxuICAgIHJldHVybiBpc1ZhbGlkO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldFZhbGlkYXRvciA9ICh0eXBlOiBWYWxpZGF0aW9uVHlwZSwgdmFsdWU6IFZhbGlkYXRpb25WYWx1ZSk6IFZhbGlkYXRvciA9PiAoeyB0eXBlLCB2YWx1ZSB9KTtcblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlID0gKHZhbHVlOiBGb3JtVmFsdWVUeXBlLCB2YWxpZGF0b3JzOiBWYWxpZGF0b3JbXSwgc3RhdGU6IEZvcm1TdGF0ZTxhbnk+KTogYm9vbGVhbiA9PiB7XG4gICAgbGV0IGlzVmFsaWQ6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHZhbGlkYXRvcnMuZm9yRWFjaCgodmFsaWRhdG9yKSA9PiB7XG4gICAgICAgIGNvbnN0IGZ1bmM6IFZhbGlkYXRpb25GdW5jIHwgdW5kZWZpbmVkID0gdmFsaWRhdGlvbkZ1bmNbdmFsaWRhdG9yLnR5cGVdO1xuICAgICAgICBpZiAodHlwZW9mIGZ1bmMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBpc1ZhbGlkID0gZnVuYyh2YWx1ZSwgaXNWYWxpZCwgdmFsaWRhdG9yLCBzdGF0ZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gaXNWYWxpZDtcbn07XG4iXX0=