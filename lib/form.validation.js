"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validate = exports.getValidator = exports.countNumbers = exports.countUpperCase = exports.count = exports.ValidationType = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _validationFunc;

/* Predefined validation options. However, a custom rule, which takes a function, can be created
   and thus any validation rule that is desired, can be created. */
var ValidationType;
/* Function that is tied to a custom rule. Must return a boolean and will always receive two arguments: 
   value: current value of the input field where this custom rule is tied 
   state: the most updated state of the entire form. */

exports.ValidationType = ValidationType;

(function (ValidationType) {
  ValidationType["Require"] = "isRequired";
  ValidationType["MinLength"] = "minLength";
  ValidationType["MaxLength"] = "maxLength";
  ValidationType["MinValue"] = "minValue";
  ValidationType["MaxValue"] = "maxValue";
  ValidationType["MinUppercaseCharacters"] = "minUppercaseCharacters";
  ValidationType["MaxUppercaseCharacters"] = "maxUppercaseCharacters";
  ValidationType["MinNumericalSymbols"] = "minNumericalSymbols";
  ValidationType["MaxNumericalSymbols"] = "maxNumericalSymbols";
  ValidationType["CustomRule"] = "customRule";
})(ValidationType || (exports.ValidationType = ValidationType = {}));

var count = function count(target, callback) {
  var result = 0;

  for (var i = 0; i < target.length; i++) {
    if (callback(target[i])) {
      result++;
    }
  }

  return result;
};

exports.count = count;

var countUpperCase = function countUpperCase(target) {
  return count(target, function (e) {
    return e >= 'A' && e <= 'Z';
  });
};

exports.countUpperCase = countUpperCase;

var countNumbers = function countNumbers(target) {
  return count(target, function (e) {
    var n = parseInt(e);
    return typeof n === 'number' && !Number.isNaN(n);
  });
};

exports.countNumbers = countNumbers;
var validationFunc = (_validationFunc = {}, (0, _defineProperty2["default"])(_validationFunc, ValidationType.Require, function (value, isValid) {
  return isValid && value.toString().trim().length > 0;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MinLength, function (value, isValid, validator) {
  return isValid && value.toString().trim().length >= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MaxLength, function (value, isValid, validator) {
  return isValid && value.toString().trim().length <= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MinValue, function (value, isValid, validator) {
  return isValid && +value >= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MaxValue, function (value, isValid, validator) {
  return isValid && +value <= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MinUppercaseCharacters, function (value, isValid, validator) {
  var uppercaseChars = countUpperCase(value.toString());
  return isValid && uppercaseChars >= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MaxUppercaseCharacters, function (value, isValid, validator) {
  var uppercaseChars = countUpperCase(value.toString());
  return isValid && uppercaseChars <= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MinNumericalSymbols, function (value, isValid, validator) {
  var numericalSymbols = countNumbers(value.toString());
  return isValid && numericalSymbols >= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.MaxNumericalSymbols, function (value, isValid, validator) {
  var numericalSymbols = countNumbers(value.toString());
  return isValid && numericalSymbols <= validator.value;
}), (0, _defineProperty2["default"])(_validationFunc, ValidationType.CustomRule, function (value, isValid, validator, state) {
  return isValid && typeof validator.value === 'function' && validator.value(value, state);
}), _validationFunc);

var getValidator = function getValidator(type, value) {
  return {
    type: type,
    value: value
  };
};

exports.getValidator = getValidator;

var validate = function validate(value, validators, state) {
  var isValid = true;
  validators.forEach(function (validator) {
    var func = validationFunc[validator.type];

    if (typeof func !== 'undefined') {
      isValid = func(value, isValid, validator, state);
    }
  });
  return isValid;
};

exports.validate = validate;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9mb3JtLnZhbGlkYXRpb24udHMiXSwibmFtZXMiOlsiVmFsaWRhdGlvblR5cGUiLCJjb3VudCIsInRhcmdldCIsImNhbGxiYWNrIiwicmVzdWx0IiwiaSIsImxlbmd0aCIsImNvdW50VXBwZXJDYXNlIiwiZSIsImNvdW50TnVtYmVycyIsIm4iLCJwYXJzZUludCIsIk51bWJlciIsImlzTmFOIiwidmFsaWRhdGlvbkZ1bmMiLCJSZXF1aXJlIiwidmFsdWUiLCJpc1ZhbGlkIiwidG9TdHJpbmciLCJ0cmltIiwiTWluTGVuZ3RoIiwidmFsaWRhdG9yIiwiTWF4TGVuZ3RoIiwiTWluVmFsdWUiLCJNYXhWYWx1ZSIsIk1pblVwcGVyY2FzZUNoYXJhY3RlcnMiLCJ1cHBlcmNhc2VDaGFycyIsIk1heFVwcGVyY2FzZUNoYXJhY3RlcnMiLCJNaW5OdW1lcmljYWxTeW1ib2xzIiwibnVtZXJpY2FsU3ltYm9scyIsIk1heE51bWVyaWNhbFN5bWJvbHMiLCJDdXN0b21SdWxlIiwic3RhdGUiLCJnZXRWYWxpZGF0b3IiLCJ0eXBlIiwidmFsaWRhdGUiLCJ2YWxpZGF0b3JzIiwiZm9yRWFjaCIsImZ1bmMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFFQTtBQUNBO0lBQ1lBLGM7QUFhWjtBQUNBO0FBQ0E7Ozs7V0FmWUEsYztBQUFBQSxFQUFBQSxjO0FBQUFBLEVBQUFBLGM7QUFBQUEsRUFBQUEsYztBQUFBQSxFQUFBQSxjO0FBQUFBLEVBQUFBLGM7QUFBQUEsRUFBQUEsYztBQUFBQSxFQUFBQSxjO0FBQUFBLEVBQUFBLGM7QUFBQUEsRUFBQUEsYztBQUFBQSxFQUFBQSxjO0dBQUFBLGMsOEJBQUFBLGM7O0FBbUNMLElBQU1DLEtBQUssR0FBRyxTQUFSQSxLQUFRLENBQUNDLE1BQUQsRUFBaUJDLFFBQWpCLEVBQWtFO0FBQ25GLE1BQUlDLE1BQU0sR0FBRyxDQUFiOztBQUNBLE9BQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0gs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RCxFQUFlO0FBQzlCLFFBQU1pQixJQUFnQyxHQUFHeEIsY0FBYyxDQUFDTyxTQUFTLENBQUNhLElBQVgsQ0FBdkQ7O0FBQ0EsUUFBSSxPQUFPSSxJQUFQLEtBQWdCLFdBQXBCLEVBQWlDO0FBQzdCckIsTUFBQUEsT0FBTyxHQUFHcUIsSUFBSSxDQUFDdEIsS0FBRCxFQUFRQyxPQUFSLEVBQWlCSSxTQUFqQixFQUE0QlcsS0FBNUIsQ0FBZDtBQUNIO0FBQ0osR0FMRDtBQU1BLFNBQU9mLE9BQVA7QUFDSCxDQVRNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9ybVN0YXRlLCBGb3JtVmFsdWVUeXBlLCBGb3JtRW50cnlDb25zdHJhaW50IH0gZnJvbSAnLi9mb3JtLmhvb2snO1xuXG4vKiBQcmVkZWZpbmVkIHZhbGlkYXRpb24gb3B0aW9ucy4gSG93ZXZlciwgYSBjdXN0b20gcnVsZSwgd2hpY2ggdGFrZXMgYSBmdW5jdGlvbiwgY2FuIGJlIGNyZWF0ZWRcbiAgIGFuZCB0aHVzIGFueSB2YWxpZGF0aW9uIHJ1bGUgdGhhdCBpcyBkZXNpcmVkLCBjYW4gYmUgY3JlYXRlZC4gKi9cbmV4cG9ydCBlbnVtIFZhbGlkYXRpb25UeXBlIHtcbiAgICBSZXF1aXJlID0gJ2lzUmVxdWlyZWQnLFxuICAgIE1pbkxlbmd0aCA9ICdtaW5MZW5ndGgnLFxuICAgIE1heExlbmd0aCA9ICdtYXhMZW5ndGgnLFxuICAgIE1pblZhbHVlID0gJ21pblZhbHVlJyxcbiAgICBNYXhWYWx1ZSA9ICdtYXhWYWx1ZScsXG4gICAgTWluVXBwZXJjYXNlQ2hhcmFjdGVycyA9ICdtaW5VcHBlcmNhc2VDaGFyYWN0ZXJzJyxcbiAgICBNYXhVcHBlcmNhc2VDaGFyYWN0ZXJzID0gJ21heFVwcGVyY2FzZUNoYXJhY3RlcnMnLFxuICAgIE1pbk51bWVyaWNhbFN5bWJvbHMgPSAnbWluTnVtZXJpY2FsU3ltYm9scycsXG4gICAgTWF4TnVtZXJpY2FsU3ltYm9scyA9ICdtYXhOdW1lcmljYWxTeW1ib2xzJyxcbiAgICBDdXN0b21SdWxlID0gJ2N1c3RvbVJ1bGUnXG59XG5cbi8qIEZ1bmN0aW9uIHRoYXQgaXMgdGllZCB0byBhIGN1c3RvbSBydWxlLiBNdXN0IHJldHVybiBhIGJvb2xlYW4gYW5kIHdpbGwgYWx3YXlzIHJlY2VpdmUgdHdvIGFyZ3VtZW50czogXG4gICB2YWx1ZTogY3VycmVudCB2YWx1ZSBvZiB0aGUgaW5wdXQgZmllbGQgd2hlcmUgdGhpcyBjdXN0b20gcnVsZSBpcyB0aWVkIFxuICAgc3RhdGU6IHRoZSBtb3N0IHVwZGF0ZWQgc3RhdGUgb2YgdGhlIGVudGlyZSBmb3JtLiAqL1xuZXhwb3J0IHR5cGUgQ3VzdG9tVmFsaWRhdGlvblJ1bGU8VCBleHRlbmRzIEZvcm1WYWx1ZVR5cGUsIFMgZXh0ZW5kcyBGb3JtRW50cnlDb25zdHJhaW50ID0gYW55PiA9IChcbiAgICB2YWx1ZTogVCxcbiAgICBzdGF0ZTogRm9ybVN0YXRlPFM+XG4pID0+IGJvb2xlYW47XG5cbmV4cG9ydCB0eXBlIFZhbGlkYXRpb25WYWx1ZSA9IEZvcm1WYWx1ZVR5cGUgfCBDdXN0b21WYWxpZGF0aW9uUnVsZTxhbnksIGFueT47XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdG9yIHtcbiAgICB0eXBlOiBWYWxpZGF0aW9uVHlwZTtcbiAgICB2YWx1ZTogVmFsaWRhdGlvblZhbHVlO1xufVxuXG5leHBvcnQgdHlwZSBWYWxpZGF0aW9uRnVuYyA9IChcbiAgICB2YWx1ZTogRm9ybVZhbHVlVHlwZSxcbiAgICBpc1ZhbGlkOiBib29sZWFuLFxuICAgIHZhbGlkYXRvcjogVmFsaWRhdG9yLFxuICAgIHN0YXRlOiBGb3JtU3RhdGU8YW55PlxuKSA9PiBib29sZWFuO1xuXG5leHBvcnQgY29uc3QgY291bnQgPSAodGFyZ2V0OiBzdHJpbmcsIGNhbGxiYWNrOiAoZW50cnk6IHN0cmluZykgPT4gYm9vbGVhbik6IG51bWJlciA9PiB7XG4gICAgbGV0IHJlc3VsdCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGNhbGxiYWNrKHRhcmdldFtpXSkpIHtcbiAgICAgICAgICAgIHJlc3VsdCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG5leHBvcnQgY29uc3QgY291bnRVcHBlckNhc2UgPSAodGFyZ2V0OiBzdHJpbmcpOiBudW1iZXIgPT4ge1xuICAgIHJldHVybiBjb3VudCh0YXJnZXQsIChlKSA9PiBlID49ICdBJyAmJiBlIDw9ICdaJyk7XG59O1xuXG5leHBvcnQgY29uc3QgY291bnROdW1iZXJzID0gKHRhcmdldDogc3RyaW5nKTogbnVtYmVyID0+IHtcbiAgICByZXR1cm4gY291bnQodGFyZ2V0LCAoZSkgPT4ge1xuICAgICAgICBjb25zdCBuID0gcGFyc2VJbnQoZSk7XG4gICAgICAgIHJldHVybiB0eXBlb2YgbiA9PT0gJ251bWJlcicgJiYgIU51bWJlci5pc05hTihuKTtcbiAgICB9KTtcbn07XG5cbmNvbnN0IHZhbGlkYXRpb25GdW5jOiB7IFtrZXk6IHN0cmluZ106IFZhbGlkYXRpb25GdW5jIH0gPSB7XG4gICAgW1ZhbGlkYXRpb25UeXBlLlJlcXVpcmVdOiAodmFsdWUsIGlzVmFsaWQpID0+IHtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgJiYgdmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoID4gMDtcbiAgICB9LFxuICAgIFtWYWxpZGF0aW9uVHlwZS5NaW5MZW5ndGhdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvcikgPT4ge1xuICAgICAgICByZXR1cm4gaXNWYWxpZCAmJiB2YWx1ZS50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggPj0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLk1heExlbmd0aF06ICh2YWx1ZSwgaXNWYWxpZCwgdmFsaWRhdG9yKSA9PiB7XG4gICAgICAgIHJldHVybiBpc1ZhbGlkICYmIHZhbHVlLnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCA8PSB2YWxpZGF0b3IudmFsdWU7XG4gICAgfSxcbiAgICBbVmFsaWRhdGlvblR5cGUuTWluVmFsdWVdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvcikgPT4ge1xuICAgICAgICByZXR1cm4gaXNWYWxpZCAmJiArdmFsdWUgPj0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLk1heFZhbHVlXTogKHZhbHVlLCBpc1ZhbGlkLCB2YWxpZGF0b3IpID0+IHtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgJiYgK3ZhbHVlIDw9IHZhbGlkYXRvci52YWx1ZTtcbiAgICB9LFxuICAgIFtWYWxpZGF0aW9uVHlwZS5NaW5VcHBlcmNhc2VDaGFyYWN0ZXJzXTogKHZhbHVlLCBpc1ZhbGlkLCB2YWxpZGF0b3IpID0+IHtcbiAgICAgICAgY29uc3QgdXBwZXJjYXNlQ2hhcnM6IG51bWJlciA9IGNvdW50VXBwZXJDYXNlKHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgICAgICByZXR1cm4gaXNWYWxpZCAmJiB1cHBlcmNhc2VDaGFycyA+PSB2YWxpZGF0b3IudmFsdWU7XG4gICAgfSxcbiAgICBbVmFsaWRhdGlvblR5cGUuTWF4VXBwZXJjYXNlQ2hhcmFjdGVyc106ICh2YWx1ZSwgaXNWYWxpZCwgdmFsaWRhdG9yKSA9PiB7XG4gICAgICAgIGNvbnN0IHVwcGVyY2FzZUNoYXJzOiBudW1iZXIgPSBjb3VudFVwcGVyQ2FzZSh2YWx1ZS50b1N0cmluZygpKTtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgJiYgdXBwZXJjYXNlQ2hhcnMgPD0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLk1pbk51bWVyaWNhbFN5bWJvbHNdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvcikgPT4ge1xuICAgICAgICBjb25zdCBudW1lcmljYWxTeW1ib2xzOiBudW1iZXIgPSBjb3VudE51bWJlcnModmFsdWUudG9TdHJpbmcoKSk7XG4gICAgICAgIHJldHVybiBpc1ZhbGlkICYmIG51bWVyaWNhbFN5bWJvbHMgPj0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLk1heE51bWVyaWNhbFN5bWJvbHNdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvcikgPT4ge1xuICAgICAgICBjb25zdCBudW1lcmljYWxTeW1ib2xzOiBudW1iZXIgPSBjb3VudE51bWJlcnModmFsdWUudG9TdHJpbmcoKSk7XG4gICAgICAgIHJldHVybiBpc1ZhbGlkICYmIG51bWVyaWNhbFN5bWJvbHMgPD0gdmFsaWRhdG9yLnZhbHVlO1xuICAgIH0sXG4gICAgW1ZhbGlkYXRpb25UeXBlLkN1c3RvbVJ1bGVdOiAodmFsdWUsIGlzVmFsaWQsIHZhbGlkYXRvciwgc3RhdGUpID0+IHtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgJiYgdHlwZW9mIHZhbGlkYXRvci52YWx1ZSA9PT0gJ2Z1bmN0aW9uJyAmJiB2YWxpZGF0b3IudmFsdWUodmFsdWUsIHN0YXRlKTtcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0VmFsaWRhdG9yID0gKHR5cGU6IFZhbGlkYXRpb25UeXBlLCB2YWx1ZTogVmFsaWRhdGlvblZhbHVlKTogVmFsaWRhdG9yID0+ICh7IHR5cGUsIHZhbHVlIH0pO1xuXG5leHBvcnQgY29uc3QgdmFsaWRhdGUgPSAodmFsdWU6IEZvcm1WYWx1ZVR5cGUsIHZhbGlkYXRvcnM6IFZhbGlkYXRvcltdLCBzdGF0ZTogRm9ybVN0YXRlPGFueT4pOiBib29sZWFuID0+IHtcbiAgICBsZXQgaXNWYWxpZDogYm9vbGVhbiA9IHRydWU7XG4gICAgdmFsaWRhdG9ycy5mb3JFYWNoKCh2YWxpZGF0b3IpID0+IHtcbiAgICAgICAgY29uc3QgZnVuYzogVmFsaWRhdGlvbkZ1bmMgfCB1bmRlZmluZWQgPSB2YWxpZGF0aW9uRnVuY1t2YWxpZGF0b3IudHlwZV07XG4gICAgICAgIGlmICh0eXBlb2YgZnVuYyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGlzVmFsaWQgPSBmdW5jKHZhbHVlLCBpc1ZhbGlkLCB2YWxpZGF0b3IsIHN0YXRlKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBpc1ZhbGlkO1xufTtcbiJdfQ==